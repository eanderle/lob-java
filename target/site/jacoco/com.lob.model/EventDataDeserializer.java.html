<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EventDataDeserializer.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lob-java</a> &gt; <a href="index.source.html" class="el_package">com.lob.model</a> &gt; <span class="el_source">EventDataDeserializer.java</span></div><h1>EventDataDeserializer.java</h1><pre class="source lang-java linenums">package com.lob.model;

import java.lang.reflect.Type;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import com.google.gson.JsonArray;
import com.google.gson.JsonDeserializationContext;
import com.google.gson.JsonDeserializer;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParseException;
import com.google.gson.JsonPrimitive;
import com.lob.net.APIResource;

<span class="nc" id="L17">public class EventDataDeserializer implements JsonDeserializer&lt;EventData&gt; {</span>

	@SuppressWarnings(&quot;rawtypes&quot;)
<span class="nc" id="L20">	static Map&lt;String, Class&gt; objectMap = new HashMap&lt;String, Class&gt;();</span>
    static {
<span class="nc" id="L22">        objectMap.put(&quot;address&quot;, Address.class);</span>
<span class="nc" id="L23">        objectMap.put(&quot;bank_account&quot;, Bank_account.class);</span>
<span class="nc" id="L24">        objectMap.put(&quot;check&quot;, Check.class);</span>
<span class="nc" id="L25">        objectMap.put(&quot;country&quot;, Country.class);</span>
<span class="nc" id="L26">        objectMap.put(&quot;object&quot;, Object.class);</span>
<span class="nc" id="L27">        objectMap.put(&quot;packaging&quot;, Packaging.class);</span>
<span class="nc" id="L28">        objectMap.put(&quot;postcard&quot;, Postcard.class);</span>
<span class="nc" id="L29">        objectMap.put(&quot;service&quot;, Service.class);</span>
<span class="nc" id="L30">        objectMap.put(&quot;setting&quot;, Setting.class);</span>
<span class="nc" id="L31">        objectMap.put(&quot;state&quot;, State.class);</span>
<span class="nc" id="L32">    }</span>
    
    private java.lang.Object deserializeJsonPrimitive(JsonPrimitive element) {
<span class="nc bnc" id="L35" title="All 2 branches missed.">    	if (element.isBoolean()) {</span>
<span class="nc" id="L36">    		return element.getAsBoolean();</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">    	} else if (element.isNumber()) {</span>
<span class="nc" id="L38">    		return element.getAsNumber();</span>
    	} else {
<span class="nc" id="L40">    		return element.getAsString();</span>
    	}
    }
    
    private java.lang.Object[] deserializeJsonArray(JsonArray arr) {
<span class="nc" id="L45">    	java.lang.Object[] elems = new java.lang.Object[arr.size()];</span>
<span class="nc" id="L46">    	Iterator&lt;JsonElement&gt; elemIter = arr.iterator();</span>
<span class="nc" id="L47">    	int i = 0;</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">    	while (elemIter.hasNext()) {</span>
<span class="nc" id="L49">    		JsonElement elem = elemIter.next();</span>
<span class="nc" id="L50">    		elems[i++] = deserializeJsonElement(elem);</span>
<span class="nc" id="L51">    	}</span>
<span class="nc" id="L52">    	return elems;</span>
    }
    
    private java.lang.Object deserializeJsonElement(JsonElement element) {
<span class="nc bnc" id="L56" title="All 2 branches missed.">    	if (element.isJsonNull()) {</span>
<span class="nc" id="L57">    		return null;</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">    	} else if (element.isJsonObject()) {</span>
<span class="nc" id="L59">			Map&lt;String, java.lang.Object&gt; valueMap = new HashMap&lt;String, java.lang.Object&gt;();</span>
<span class="nc" id="L60">			populateMapFromJSONObject(valueMap, element.getAsJsonObject());</span>
<span class="nc" id="L61">			return valueMap;</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">		} else if (element.isJsonPrimitive()) {</span>
<span class="nc" id="L63">			return deserializeJsonPrimitive(element.getAsJsonPrimitive());</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">		} else if (element.isJsonArray()) {</span>
<span class="nc" id="L65">			return deserializeJsonArray(element.getAsJsonArray());</span>
		} else {
<span class="nc" id="L67">			System.err.println(&quot;Unknown JSON element type for element &quot; + element + &quot;. &quot; +</span>
					&quot;If you're seeing this messaage, it's probably a bug in the Stripe Java &quot; +
					&quot;library. Please contact us by email at support@stripe.com.&quot;);
<span class="nc" id="L70">			return null;</span>
		}
	}
    
    private void populateMapFromJSONObject(Map&lt;String, java.lang.Object&gt; objMap, JsonObject jsonObject) {
<span class="nc bnc" id="L75" title="All 2 branches missed.">		for(Map.Entry&lt;String, JsonElement&gt; entry: jsonObject.entrySet()) {</span>
<span class="nc" id="L76">			String key = entry.getKey();</span>
<span class="nc" id="L77">			JsonElement element = entry.getValue();</span>
<span class="nc" id="L78">			objMap.put(key, deserializeJsonElement(element));</span>
<span class="nc" id="L79">		}</span>
<span class="nc" id="L80">    }</span>

	@SuppressWarnings(&quot;unchecked&quot;)
	public EventData deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context)
			throws JsonParseException {
<span class="nc" id="L85">		EventData eventData = new EventData();</span>
<span class="nc" id="L86">		JsonObject jsonObject = json.getAsJsonObject();</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">		for(Map.Entry&lt;String, JsonElement&gt; entry: jsonObject.entrySet()) {</span>
<span class="nc" id="L88">			String key = entry.getKey();</span>
<span class="nc" id="L89">			JsonElement element = entry.getValue();</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">			if(&quot;previous_attributes&quot;.equals(key)) {</span>
<span class="nc" id="L91">				Map&lt;String, java.lang.Object&gt; previousAttributes = new HashMap&lt;String, java.lang.Object&gt;();</span>
<span class="nc" id="L92">				populateMapFromJSONObject(previousAttributes, element.getAsJsonObject());</span>
<span class="nc" id="L93">				eventData.setPreviousAttributes(previousAttributes);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">			} else if (&quot;object&quot;.equals(key)) {</span>
<span class="nc" id="L95">				String type = element.getAsJsonObject().get(&quot;object&quot;).getAsString();</span>
<span class="nc" id="L96">				Class&lt;LobObject&gt; cl = objectMap.get(type);</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">				LobObject object = APIResource.gson.fromJson(entry.getValue(), cl != null ? cl : LobRawJsonObject.class);</span>
<span class="nc" id="L98">				eventData.setObject(object);</span>
			}
<span class="nc" id="L100">		}</span>
<span class="nc" id="L101">		return eventData;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>